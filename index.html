<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prototipo de VotaciÃ³n</title>

  <!-- Tu CSS -->
  <link rel="stylesheet" href="./styles.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- LibrerÃ­as externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- Tu lÃ³gica JS -->
  <script src="./app.js" defer></script>
</head>
<body>
  <div id="particles-js"></div>

  <!-- ğŸ” LOGIN PAGE -->
  <div class="login-page">
    <section id="login">
      <div class="login-container">
        <h1 class="titulo-general">
          DirecciÃ³n de Enlace Legislativo<br>
          <span>Sistema de VotaciÃ³n Parlamentaria</span>
        </h1>
        <h2>ğŸ” Iniciar SesiÃ³n</h2>
        <form id="loginForm" onsubmit="event.preventDefault(); login();">
          <label for="usuarioLogin">Usuario</label>
          <input type="text" id="usuarioLogin" required />
          <label for="passwordLogin">ContraseÃ±a</label>
          <input type="password" id="passwordLogin" required />
          <button type="submit">Ingresar</button>
          <p id="loginError" class="hidden error">âš ï¸ Usuario o contraseÃ±a incorrectos.</p>
        </form>
        <p class="olvido">
          Â¿Olvidaste tu contraseÃ±a?
          <a href="https://wa.me/4433664188" target="_blank">ContÃ¡ctanos por WhatsApp</a>
        </p>
      </div>
    </section>
  </div>

  <!-- ğŸ“¦ MAIN APP (se muestra despuÃ©s de login) -->
  <div class="sidebar hidden">
    <h2>ğŸ—³ï¸ VotaciÃ³n</h2>
    <a onclick="showSection('uploadOrden')">Orden del DÃ­a</a>
    <a onclick="showSection('sesion')">SesiÃ³n</a>
    <a id="linkResultados" style="display:none" onclick="showSection('resultados')">Resultados</a>
    <a onclick="showSection('sesionesPasadas')">Sesiones Pasadas</a>
  </div>

  <div class="main hidden">
    <div class="page-panel">

    <h1 class="titulo-general">
      DirecciÃ³n de Enlace Legislativo<br>
      <span>Sistema de VotaciÃ³n Parlamentaria</span>
    </h1>

    <!-- 0) Carga Orden del DÃ­a -->
    <section id="uploadOrden" class="hidden">
      <h2>ğŸ“„ Carga la Orden del DÃ­a</h2>
      <input type="file" id="fileOrden" accept="application/pdf" />
      <button onclick="uploadOrden()">Procesar Orden del DÃ­a</button>
      <div id="previewOrden" class="hidden" style="margin-top:1rem;">
        <h3 id="previewSesion"></h3>
        <p id="previewNombreSesionOriginal" style="color:#555;"></p>
        <ul id="previewAsuntos"></ul>
        <div class="botones">
          <button onclick="confirmarOrden()">âœ… Confirmar e Iniciar VotaciÃ³n</button>
        </div>
      </div>
    </section>
    <!-- 1) Bienvenida -->
    <section id="bienvenida" class="hidden">
      <h2>ğŸ—³ï¸ Bienvenido al Sistema de VotaciÃ³n</h2>
      <p>Inicia una sesiÃ³n para comenzar.</p>
      <button onclick="iniciarApp()">Comenzar</button>
    </section>

    <!-- 2) SesiÃ³n -->
    <section id="sesion" class="hidden">
      <div id="sesionActiva" class="hidden">
        <p>SesiÃ³n activa: <strong id="nombreSesionActivo"></strong></p>
      </div>
      <div id="registroSesion">
        <label for="nombreSesion">Nombre de la sesiÃ³n:</label><br/>
        <input type="text" id="nombreSesion" placeholder="Ej.: SesiÃ³n Ordinaria 2025" />
        <button onclick="guardarSesion()">Empezar VotaciÃ³n</button>
      </div>
    </section>

    <!-- 3) Asunto -->
    <section id="asunto" class="hidden">
      <h2>ğŸ“ Selecciona un Asunto</h2>
      <select id="listaAsuntos"></select>
      <button onclick="guardarAsunto()">Iniciar VotaciÃ³n</button>
    </section>

    <!-- 4) Diputados -->
    <section id="diputados" class="hidden">
      <h2>Vota por cada diputado:</h2>
      <input
      type="search"
      id="buscadorDiputado"
      placeholder="Buscar diputado por nombre..."
      oninput="filtrarDiputados()"
      enterkeyhint="search"
      inputmode="search"
      spellcheck="false"
      autocomplete="off"
      autocapitalize="off"
      style="margin-bottom:1rem; padding:0.5rem; width:100%; max-width:400px; border:2px solid #800000; border-radius:8px;"
    />
    



    <div id="diputados-container"></div>
    </section>

    <!-- 5) Resultados por Asunto -->
    <section id="resultados" class="hidden">
      <div class="container-page">
        <div class="card soft">
          <h2 class="section-title">Resumen de Resultados</h2>
    
          <!-- AquÃ­ inyectamos el tÃ­tulo de SesiÃ³n/Asunto y los totales -->
          <div id="resumenSesion"></div>
    
          <!-- GrÃ¡fica -->
          <div class="card" style="margin-top:12px;">
            <canvas id="chartResumen" class="hidden"></canvas>
          </div>
    
          <!-- Acciones del ASUNTO -->
          <div id="botonSiguienteAsunto" class="hidden actions" style="margin-top:14px;">
            <button class="full" onclick="avanzarAlSiguienteAsunto()">â­ï¸ Siguiente Asunto</button>
          </div>
    
          <div class="actions" style="margin-top:6px;">
            <button onclick="exportAsuntoTXT()">Descargar Asunto (TXT)</button>
            <button onclick="exportAsuntoPDF()">Descargar Asunto (PDF)</button>
            <button onclick="exportAsuntoXLS()">Descargar Asunto (Excel)</button>
          </div>
    
          <hr style="border:none; border-top:1px solid #f0dcdc; margin:16px 0;"/>
          <!-- Acciones de la SESIÃ“N -->
          <div id="accionesSesion" class="actions hidden">

            <button class="full" onclick="mostrarResumenSesion()">Ver Resumen de SesiÃ³n</button>
            <button onclick="exportSesionTXT()">Descargar SesiÃ³n (TXT)</button>
            <button onclick="exportSesionPDF()">Descargar SesiÃ³n (PDF)</button>
            <button onclick="exportSesionXLS()">Descargar SesiÃ³n (Excel)</button>
      </div>
  
  
    
          <pre id="resumenSesionCompleto" class="hidden"></pre>
        </div>
      </div>
    </section>       

    <!-- 7) Sesiones pasadas -->
    <section id="sesionesPasadas" class="hidden">
      <h2>ğŸ—‚ï¸ Sesiones Pasadas</h2>
      <ul id="listaSesionesPasadas"></ul>
    </section>

    <!-- 6) Terminar SesiÃ³n -->
    <div id="botonTerminarSesion" class="hidden">
      <button onclick="terminarSesion()">ğŸ” Terminar SesiÃ³n</button>
    </div>
    </div>
  </div>
</body>
</html>
