<!DOCTYPE html>
<html lang="es">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prototipo de Votaci√≥n</title>

  <!-- Tu CSS -->

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./styles.css?v=20251002b"/>
<!-- Librer√≠as externas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

<!-- Tu l√≥gica JS -->
<script src="./app.js?v=20250925a" defer></script>
</head>
<body>

  <div id="particles-js"></div>

  <!-- LOGIN PAGE -->
  <div class="login-page">
    <section id="login">
      <div class="login-container">
        <h1 class="titulo-general">
          Direcci√≥n de Enlace Legislativo<br>
          <span>Sistema de Votaci√≥n Parlamentaria</span>
        </h1>
        <h2> Iniciar Sesi√≥n</h2>
        <form id="loginForm" onsubmit="event.preventDefault(); login();">
          <label for="usuarioLogin">Usuario</label>
          <input type="text" id="usuarioLogin" required />
          <label for="passwordLogin">Contrase√±a</label>
          <input type="password" id="passwordLogin" required />
          <button type="submit">Ingresar</button>
          <p id="loginError" class="hidden error"> Usuario o contrase√±a incorrectos.</p>
        </form>
        <p class="olvido">
          ¬øOlvidaste tu contrase√±a?
          <a href="https://wa.me/4433664188" target="_blank">Cont√°ctanos por WhatsApp</a>
        </p>
      </div>
    </section>
  </div>

  <!--  MAIN APP (se muestra despu√©s de login) -->
  <div class="sidebar hidden">
    <h2>üó≥Ô∏è Votaci√≥n</h2>
    <button type="button" class="side-link" onclick="showSection('uploadOrden')">
      Orden del D√≠a
    </button>
  
    <button type="button" class="side-link" onclick="showSection('sesion')">
      Sesi√≥n
    </button>
  
    <button type="button" id="linkResultados" class="side-link" onclick="showSection('resultados')">
      Resultados
    </button>
  
    <button type="button" class="side-link" onclick="showSection('sesionesPasadas')">
      Sesiones Pasadas
    </button>
  </div>

  <div class="main hidden">
    <div class="page-panel">

    <!-- 0) Carga Orden del D√≠a -->
    <section id="uploadOrden" class="hidden">
      <h2>üìÑ Subir la Orden del D√≠a</h2>
      <input type="file" id="fileOrden" accept="application/pdf" />
      <button onclick="subirOrden()">Subir Orden del D√≠a</button>
    
      <!-- aviso de √©xito -->
      <p id="msgOrden" class="hidden" style="margin-top:10px;color:#2b7a2b;font-weight:600;">
        ‚úîÔ∏è Orden del D√≠a subida. Ve a la pesta√±a <b>Sesi√≥n</b> para procesarla.
      </p>
    </section>    

    <!-- 1) Bienvenida -->
    <section id="bienvenida" class="hidden">
      <h2>üó≥Ô∏è Bienvenido al Sistema de Votaci√≥n</h2>
      <p>Inicia una sesi√≥n para comenzar.</p>
      <button onclick="iniciarApp()">Comenzar</button>
    </section>

   <!-- 0.1) Confirmar Orden del D√≠a (previa editable) -->
<section id="confirmarOrden" class="hidden">
  <h2>üßæ Orden detectada</h2>

  <p id="previewSesion" style="margin:.4rem 0 1rem; font-weight:600; color:#800000;">
    Sesi√≥n:
  </p>

  <!-- LISTA DE ASUNTOS EDITABLE -->
  <ol id="previewAsuntos" class="lista-asuntos"></ol>

  <div class="actions" style="margin-top:12px;">
    <!-- Bot√≥n √∫nico que confirma e inicia la votaci√≥n -->
    <button class="full" onclick="confirmarOrden()"> Confirmar e iniciar votaci√≥n</button>
    <button onclick="showSection('uploadOrden')">‚Ü© Volver</button>
  </div>
</section>


    <!-- 2) Sesi√≥n -->
    <section id="sesion" class="hidden">
      <h2>üóÉÔ∏è Sesiones subidas</h2>
    
      <div style="margin:10px 0 14px;">
        
        <input id="buscadorSes" type="search"
               placeholder="Buscar por usuario o nombre‚Ä¶"
               oninput="filtrarListaSesiones()"
               style="padding:.55rem .7rem; width:100%; max-width:520px; border:2px solid #800000; border-radius:10px;">
      </div>
    
      <div class="tabla-wrapper">
        <table class="tabla-sesiones">
          <thead>
            <tr>
              <th style="width:140px; text-align:left;">Usuario/ID</th>
              <th style="text-align:left;">Sesi√≥n / Orden del d√≠a</th>
              <th style="width:190px; text-align:left;">Fecha</th>
              <th style="width:180px; text-align:left;">Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="tbodyListaSesiones">
            <tr><td colspan="4" style="text-align:center;">Cargando‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    
      <!-- indicador de sesi√≥n activa (si lo quieres) -->
      <div id="sesionActiva" class="hidden" style="margin-top:10px;">
        Sesi√≥n activa: <strong id="nombreSesionActivo"></strong>
      </div>
    </section>    

    <!-- 3) Asunto -->
    <section id="asunto" class="hidden">
      <h2>üìù Selecciona un Asunto</h2>
      <select id="listaAsuntos"></select>
      <button id="iniciarBtn" type="button">Iniciar Sesi√≥n</button>
    </section>    

    <!-- 4) Diputados -->
    <section id="diputados" class="hidden">
      <h2>Vota por cada diputado:</h2>

      <!--  banner con el asunto actual -->
      <p id="asuntoActual" style="margin:4px 0 10px;"></p>

      <input
        type="search"
        id="buscadorDiputado"
        placeholder="Buscar diputado por nombre..."
        oninput="filtrarDiputados()"
        enterkeyhint="search"
        inputmode="search"
        spellcheck="false"
        autocomplete="off"
        autocapitalize="off"
        style="margin-bottom:1rem; padding:0.5rem; width:100%; max-width:400px; border:2px solid #800000; border-radius:8px;"
      />
      <div id="diputados-container"></div>
    </section>

    <!-- 4.1) Vista Iniciativa (SECCI√ìN PROPIA) -->
      <section id="vista-iniciativa" class="hidden">
        <h3 id="ini-titulo"></h3>

  <div style="margin:.5rem 0">
      <label>Buscar comisi√≥n</label><br>
        <input id="com-buscar" placeholder="Escribe para filtrar..." />
  </div>

  <div id="com-lista" class="lista-comisiones" style="max-height:260px;overflow:auto;border:1px solid #f0dcdc;border-radius:8px;padding:.5rem"></div>

  <div style="margin-top:10px">
    <label>Opini√≥n</label><br>
      <textarea id="ini-opinion" rows="3" style="width:100%;max-width:740px"></textarea>
  </div>

  <div style="margin-top:12px">
    <button id="ini-siguiente">Siguiente asunto</button>
  </div>
</section>

<!-- 4.2) Vista Nota (dispensa/lectura/otros) -->
<section id="vista-nota" class="hidden">
  <h3 id="nota-titulo"></h3>

  <div style="margin:.5rem 0">
    <label>Anotaciones</label><br>
    <textarea id="nota-text" rows="4" style="width:100%;max-width:740px"></textarea>
  </div>

  <div style="margin-top:12px">
    <button id="nota-siguiente">Siguiente punto</button>
  </div>
</section>


    <!-- 5) Resultados por Asunto -->
    <section id="resultados" class="hidden">
      <div class="container-page">
        <div class="card soft">
          <h2 class="section-title">Resumen de Resultados</h2>

          <div id="resumenSesion"></div>

          <div class="card" style="margin-top:12px;">
            <canvas id="chartResumen" class="hidden"></canvas>
          </div>

          <div id="botonSiguienteAsunto" class="hidden actions">
            <button class="full" onclick="avanzarAlSiguienteAsunto()">Siguiente Asunto</button>
          </div>          

          <div class="actions" style="margin-top:6px;">
            <button onclick="exportAsuntoTXT()">Descargar Asunto (TXT)</button>
            <button onclick="exportAsuntoPDF()">Descargar Asunto (PDF)</button>
            <button onclick="exportAsuntoXLS()">Descargar Asunto (Excel)</button>
          </div>

          <hr style="border:none; border-top:1px solid #f0dcdc; margin:16px 0;"/>
          <div id="accionesSesion" class="actions hidden">
            <button class="full" onclick="mostrarResumenSesion()">Ver Resumen de Sesi√≥n</button>
            <button onclick="exportSesionTXT()">Descargar Sesi√≥n (TXT)</button>
            <button onclick="exportSesionPDF()">Descargar Sesi√≥n (PDF)</button>
            <button onclick="exportSesionXLS()">Descargar Sesi√≥n (Excel)</button>
          </div>

          <pre id="resumenSesionCompleto" class="hidden"></pre>
        </div>
      </div>
    </section>

    <section id="finSesion" class="hidden">
      <h2>‚úÖ Sesi√≥n finalizada</h2>
      <p id="finSesionNombre" class="session-name"></p>
      <div class="actions" style="display:flex;gap:8px;flex-wrap:wrap">
        <button onclick="exportSesionTXT()">Descargar TXT</button>
        <button onclick="exportSesionPDF()">Descargar PDF</button>
        <button onclick="exportSesionXLS()">Descargar Excel</button>
      </div>
      <hr/>
      <button class="btn-danger" onclick="finalizarSesionParlamentaria()">Terminar sesi√≥n</button>
    </section>    
    

    <!-- 7) Sesiones pasadas (vista tipo tabla) -->
<section id="sesionesPasadas" class="hidden">
  <h2> Sesiones Pasadas</h2>
  

  <!-- Buscador (usa la funci√≥n que s√≠ existe en app.js) -->
  <div style="margin:10px 0 14px;">
    <input id="buscadorSesiones" type="search"
           placeholder="Buscar por usuario o nombre de sesi√≥n‚Ä¶"
           oninput="filtrarSesiones()"
           style="padding:.55rem .7rem; width:100%; max-width:520px; border:2px solid #800000; border-radius:10px;">
  </div>

  <div class="tabla-wrapper">
    <table class="tabla-sesiones" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="width:140px; text-align:left;">Usuario/ID</th>
          <th style="text-align:left;">Sesi√≥n / Orden del d√≠a</th>
          <th style="width:190px; text-align:left;">Fecha</th>
          <th style="width:140px; text-align:left;">Descargar</th>
          <th style="width:120px; text-align:left;">Editar</th>
          <th style="width:120px; text-align:left;">Eliminar</th>
        </tr>
      </thead>
      <!--  ESTE ID es el que usa mi app.js: cargarSesionesPasadas()  -->
      <tbody id="tablaSesionesBody">
        <tr><td colspan="6" style="text-align:center;">Cargando sesiones‚Ä¶</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ‚ÄúPor vistas‚Äù: panel con el detalle en la misma p√°gina (tu app.js lo llena con verDetallesSesion) -->
  <div id="panelVistaSesion" class="hidden card soft" style="margin-top:16px;">
    <div class="section-title">Vista de sesi√≥n</div>
    <div id="votosPrevios">Selecciona una sesi√≥n para ver el detalle.</div>
  </div>
</section>

<link rel="stylesheet" href="./styles.css?v=20251002b"/>


    <!-- 8) Terminar Sesi√≥n -->
    <div id="botonTerminarSesion" class="hidden">
      <button onclick="terminarSesion()"> Terminar Sesi√≥n</button>
    </div>

    </div>
  </div>
</body>
</html>
